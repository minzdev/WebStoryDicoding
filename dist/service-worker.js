const CACHE_NAME="storyn-app-v1",API_URL="https://story-api.dicoding.dev",ASSETS=["/","/index.html","/bundle.js","/main.css","/icons/icon-192.png","/icons/icon-512.png","/manifest.json"];self.addEventListener("install",(t=>{t.waitUntil(caches.open(CACHE_NAME).then((t=>t.addAll(ASSETS)))),self.skipWaiting()})),self.addEventListener("activate",(t=>{t.waitUntil(caches.keys().then((t=>Promise.all(t.map((t=>{if(t!==CACHE_NAME)return caches.delete(t)})))))),self.clients.claim()})),self.addEventListener("fetch",(t=>{const{request:e}=t,n=new URL(e.url);"GET"===e.method&&(n.origin!==API_URL?n.hostname.includes("tile.openstreetmap.org")||t.respondWith(caches.match(e).then((t=>t||fetch(e)))):t.respondWith(fetch(e).catch((()=>new Response(JSON.stringify({error:!0,message:"Tidak dapat terhubung ke server."}),{headers:{"Content-Type":"application/json"}})))))})),self.addEventListener("push",(t=>{let e={title:"Notifikasi Baru",options:{body:"Ada cerita baru yang telah ditambahkan!",icon:"/icons/icon-192.png",badge:"/icons/icon-192.png"}};if(t.data)try{const n=t.data.json();e.title=n.title||e.title,e.options={...e.options,...n.options}}catch(n){e.options.body=t.data.text()}t.waitUntil(self.registration.showNotification(e.title,e.options))})),self.addEventListener("notificationclick",(t=>{t.notification.close(),t.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((t=>{for(const e of t)if("/"===e.url&&"focus"in e)return e.focus();return clients.openWindow("/")})))}));